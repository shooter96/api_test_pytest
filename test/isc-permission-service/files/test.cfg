function strToBytes(str) {
    var arr = [];
    for (var i = 0; i < str.length; i++) {
        arr.push(str[i].charCodeAt());
    }
    return arr;
}

function bytes2String(bytes) {
    var str = "";
    for (i = 0; i < bytes.length; i++) {
        str += String.fromCharCode(bytes[i])
    }
    return str;
}
/*官方协议*/
var attrTemplate = {
    "operate": "ATTR_UP",
    "operateId": 1,
    "data": [{
        "pk": "",
        "devId": "",
        "identifier": "",
        "time": 1598433697087,
        "params": {
        }
    }]
};
/* {"ver":"1.0","tp":0,"id":"ucview_x270","sn":139,"st":1604025007,"data":[{"k":51,"m":"","p":2,"t":132485274074070000,"v":4.6},{"k":52,"m":"","p":2,"t":132485274074070000,"v":5.6},{"k":53,"m":"","p":2,"t":132485274074070000,"v":6.6}]}*/
/*
    私有协议转官方协议
*/
function raw2Protocol(data) {
    var str = bytes2String(data);   
    var jsonObject = JSON.parse(str);
    var dataArray = jsonObject.data;
    var attrArray = new Array();
    var devId = jsonObject.id;
    var data = new Array();
    var attr=new Object();
    attr.devId = devId;
    attr.time = new Date().getTime();
    var params=new Object();
    dataArray.forEach(d => {
       params[d.k]=d.v;
    });
    attr.params=params;
    data.push(attr);
    attrTemplate.data=data;
    return attrTemplate;
}
/*
    官方协议转私有协议
*/
function protocol2Raw(data) {
    serviceTemplate.identifier = data.data.identifier;
    return strToBytes(JSON.stringify(serviceTemplate));
}